define(["Common"],function(common){var NCZ=NCZ||{};return NCZ.IdleTimer=function(){var idle=false,tId=-1,enabled=false,timeout=3E4,handlers={};function handleUserEvent(){clearTimeout(tId);if(enabled){if(idle)toggleIdleState();tId=setTimeout(toggleIdleState,timeout)}}function toggleIdleState(){idle=!idle;fire(idle?"idle":"active")}function fire(eventType){var subscribers=handlers[eventType];if(subscribers)for(var i=0,len=subscribers.length;i<len;i++)subscribers[i].method.call(subscribers[i].scope)}
return{isRunning:function(){return enabled},isIdle:function(){return idle},start:function(newTimeout){enabled=true;idle=false;if(typeof newTimeout=="number")timeout=newTimeout;var body=document.body;if(body.addEventListener){body.addEventListener("mousemove",handleUserEvent,false);body.addEventListener("keydown",handleUserEvent,false)}else{body.attachEvent("onmousemove",handleUserEvent);body.attachEvent("onkeydown",handleUserEvent)}tId=setTimeout(toggleIdleState,timeout)},stop:function(){enabled=
false;clearTimeout(tId);var body=document.body;if(body.removeEventListener){body.removeEventListener("mousemove",handleUserEvent,false);body.removeEventListener("keydown",handleUserEvent,false)}else{body.detachEvent("onmousemove",handleUserEvent);body.detachEvent("onkeydown",handleUserEvent)}},subscribe:function(eventType,method,scope){if(!handlers[eventType])handlers[eventType]=[];handlers[eventType].push({method:method,scope:scope||common._window})},unsubscribe:function(eventType,method){if(!handlers[eventType])return;
if(!method){delete handlers[eventType];return}var i=0,subscribers=handlers[eventType],len=subscribers.length,found=false;while(i<len&!found)if(subscribers[i].method===method)found=true;else i++;if(found)subscribers.splice(i,1)}}}()});